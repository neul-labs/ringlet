# Providers

Providers define API backends that profiles connect to. They specify endpoints, authentication requirements, and available models. By separating providers from agents, ringlet lets you run the same CLI tool (e.g., Claude Code) against different backends (Anthropic, MiniMax, OpenRouter) without modifying agent manifests.

## Built-in providers

ringlet ships with these providers:

| ID | Name | Type | Endpoints |
|----|------|------|-----------|
| `anthropic` | Anthropic API | anthropic | `https://api.anthropic.com` |
| `minimax` | MiniMax | anthropic-compatible | `https://api.minimax.io/anthropic` (intl), `https://api.minimaxi.com/anthropic` (China) |
| `openai` | OpenAI API | openai | `https://api.openai.com/v1` |
| `openrouter` | OpenRouter | openai-compatible | `https://openrouter.ai/api/v1` |

## Provider manifest anatomy

| Field | Purpose |
|-------|---------|
| `id` | Stable identifier used by profiles (e.g., `minimax`, `anthropic`). |
| `name` | Human-friendly label displayed in tables. |
| `type` | API compatibility type: `anthropic`, `anthropic-compatible`, `openai`, or `openai-compatible`. |
| `endpoints` | Named endpoints (e.g., `international`, `china`) with URLs. |
| `endpoints.default` | Which endpoint to use by default. |
| `auth.env_key` | Environment variable name for the API key (e.g., `MINIMAX_API_KEY`). |
| `auth.prompt` | Message shown when prompting for credentials. |
| `models.available` | List of model identifiers available from this provider. |
| `models.default` | Default model for new profiles using this provider. |

Note: Configuration generation is handled by Rhai scripts. See `docs/scripting.md`.

## Example provider manifest

```toml
# ~/.config/ringlet/providers.d/minimax.toml
id = "minimax"
name = "MiniMax"
type = "anthropic-compatible"

[endpoints]
international = "https://api.minimax.io/anthropic"
china = "https://api.minimaxi.com/anthropic"
default = "international"

[auth]
env_key = "MINIMAX_API_KEY"
prompt = "Enter your MiniMax API key"

[models]
available = ["MiniMax-M2.1"]
default = "MiniMax-M2.1"
```

Configuration generation (environment variables, config files) is handled by agent-specific Rhai scripts. The scripts receive provider information and generate the appropriate configuration for each agent.

## How providers work with agents

When you create a profile, ringlet combines information from the agent manifest, provider manifest, and user preferences:

1. **Agent manifest** provides:
   - Detection commands (how to find the installed tool)
   - Profile isolation strategy (`home-wrapper` for full isolation)
   - Profile home template (e.g., `~/.claude-profiles/{alias}`)
   - Rhai script reference (e.g., `claude.rhai`)
   - Agent-specific hooks (create, delete, pre_run, post_run)

2. **Provider manifest** provides:
   - API endpoint URL
   - Authentication (API key prompt and storage)
   - Available models

3. **Rhai script** generates:
   - Configuration files (JSON, TOML, etc.) specific to the agent
   - Environment variables to inject at runtime
   - Optional hooks configuration (for agents like Claude Code)
   - Optional MCP server configuration

The result is a profile with fully customized configuration for both *what tool to run* (agent) and *which API backend to use* (provider).

### Example workflow

```bash
# Step 1: Create a profile binding Claude Code to MiniMax
$ ringlet profiles create claude work-minimax --provider minimax

# ringlet does the following:
# 1. Reads agent manifest for 'claude' (strategy: home-wrapper)
# 2. Reads provider manifest for 'minimax' (endpoints, auth, models)
# 3. Prompts for MiniMax API key
# 4. Creates profile home at ~/.claude-profiles/work-minimax
# 5. Runs Rhai script to generate config files and env vars
# 6. Runs agent's create hooks

# Step 2: Run with the profile
$ ringlet profiles run work-minimax -- /path/to/project

# ringlet does:
# 1. Sets HOME to ~/.claude-profiles/work-minimax (per agent strategy)
# 2. Injects env vars from profile (generated by Rhai script)
# 3. Runs agent's pre_run hooks
# 4. Spawns: claude /path/to/project
# 5. Runs agent's post_run hooks when done
```

## Adding a custom provider

1. Create a TOML file in `~/.config/ringlet/providers.d/`:

```toml
# ~/.config/ringlet/providers.d/my-gateway.toml
id = "my-gateway"
name = "Internal API Gateway"
type = "anthropic-compatible"

[endpoints]
production = "https://api.internal.company.com/llm"
staging = "https://api-staging.internal.company.com/llm"
default = "production"

[auth]
env_key = "INTERNAL_API_KEY"
prompt = "Enter your internal gateway API key"

[models]
available = ["internal-claude-3", "internal-gpt-4"]
default = "internal-claude-3"
```

Note: Configuration generation (environment variables, config files) is handled by agent-specific Rhai scripts, not by the provider manifest. See `docs/scripting.md`.

2. Use it when creating profiles:

```bash
$ ringlet profiles create claude work-internal --provider my-gateway
```

## Provider compatibility types

| Type | Description | Compatible with |
|------|-------------|-----------------|
| `anthropic` | Native Anthropic API | Claude Code, Droid, OpenCode |
| `anthropic-compatible` | Anthropic-compatible APIs (MiniMax, etc.) | Claude Code, Droid, OpenCode |
| `openai` | Native OpenAI API | Codex CLI, Grok CLI |
| `openai-compatible` | OpenAI-compatible APIs (OpenRouter, etc.) | Codex CLI, Grok CLI |

Not all agents work with all provider types. See the Agent-Provider Compatibility matrix in `docs/agents.md`.

## CLI commands

```bash
# List available providers
$ ringlet providers list
ID          Name                    Type                  Default Model
anthropic   Anthropic API           anthropic             claude-sonnet-4
minimax     MiniMax                 anthropic-compatible  MiniMax-M2.1
openai      OpenAI API              openai                gpt-4o
openrouter  OpenRouter              openai-compatible     auto

# Inspect a provider
$ ringlet providers inspect minimax
ID: minimax
Name: MiniMax
Type: anthropic-compatible
Endpoints:
  international: https://api.minimax.io/anthropic (default)
  china: https://api.minimaxi.com/anthropic
Auth: MINIMAX_API_KEY
Models: MiniMax-M2.1

# Use a specific endpoint
$ ringlet profiles create claude china-minimax --provider minimax --endpoint china
```

## Replacing manual configuration

Instead of following provider-specific setup guides (editing `~/.claude/settings.json`, `.codex/config.toml`, etc.), use ringlet:

| Manual approach | ringlet approach |
|-----------------|-------------------|
| Edit `~/.claude/settings.json` with MiniMax env vars | `ringlet profiles create claude work --provider minimax` |
| Edit `.codex/config.toml` with provider block | `ringlet profiles create codex work --provider minimax` |
| Edit `~/.factory/config.json` with custom_models | `ringlet profiles create droid work --provider minimax` |
| Export `GROK_BASE_URL` and `GROK_API_KEY` | `ringlet profiles create grok work --provider minimax` |

ringlet handles the configuration details per agent and provider, letting you focus on which tool and which backend you want to use.
